# 可靠性&可维护性测试结果记录

## 测试基本信息
- **测试人员**：D号成员
- **测试日期**：____年____月____日
- **测试环境**：
  - Spring Boot版本：3.2.0
  - Java版本：21
  - MySQL版本：____
  - 操作系统：Windows 10

---

## 任务1：数据库断开恢复测试

### 测试记录

**测试时间**：____

**步骤1：正常状态**
- 接口：`GET /api/users`
- 响应时间：`____ms`
- 状态码：`200`
- 响应内容：`____`

**步骤2：数据库断开**
- 断开方式：`停止MySQL服务 / 修改配置`
- 断开时间：`____`

**步骤3：断开后测试**
- 首次请求时间：`____`
- 响应时间：`____ms`
- 状态码：`500 / 超时`
- 错误信息：`____`

**步骤4：数据库恢复**
- 恢复时间：`____`
- 恢复方式：`启动MySQL服务 / 恢复配置`

**步骤5：自动恢复验证**
- 恢复后首次请求时间：`____`
- 响应时间：`____ms`
- 状态码：`200`
- 系统是否自动恢复：`是 / 否`
- 恢复耗时：`____秒`

### 测试结论
- [ ] 系统能够检测到数据库断开
- [ ] 系统能够自动恢复连接
- [ ] 恢复时间在可接受范围内（< 1分钟）
- [ ] 连接池配置生效

**问题记录**：`____`

---

## 任务2：异常参数导致500错误测试

### 测试记录

| 测试用例 | 请求参数 | 发送时间 | HTTP状态码 | 响应内容 | 日志是否完整 | 备注 |
|---------|---------|---------|-----------|---------|------------|------|
| 空值测试 | `{"username": null}` | | | | ✅/❌ | |
| 类型错误 | `{"username": 123}` | | | | ✅/❌ | |
| 超长字符串 | `{"username": "a...10000次"}` | | | | ✅/❌ | |
| SQL注入 | `{"username": "admin'; DROP TABLE..."}` | | | | ✅/❌ | |
| 特殊字符 | `{"username": "<script>..."}` | | | | ✅/❌ | |

### 日志截图/内容
```
[在此粘贴错误日志内容]
```

### 测试结论
- [ ] 所有异常参数都能被正确拦截
- [ ] 错误信息对用户友好
- [ ] 日志包含完整信息（时间、参数、堆栈）
- [ ] 没有泄露敏感信息

**问题记录**：`____`

---

## 任务3：服务重启恢复测试

### 功能清单测试

| 功能 | 重启前状态 | 重启后状态 | 响应时间 | 数据一致性 | 备注 |
|-----|----------|----------|---------|-----------|------|
| 用户登录 | ✅/❌ | ✅/❌ | ____ms | ✅/❌ | |
| 获取用户列表 | ✅/❌ | ✅/❌ | ____ms | ✅/❌ | |
| 创建预约 | ✅/❌ | ✅/❌ | ____ms | ✅/❌ | |
| 文件上传 | ✅/❌ | ✅/❌ | ____ms | ✅/❌ | |
| 数据库查询 | ✅/❌ | ✅/❌ | ____ms | ✅/❌ | |

### 服务启动时间
- 启动耗时：`____秒`

### 数据一致性验证
- 测试数据：用户ID=1的信息
- 重启前：`____`
- 重启后：`____`
- 是否一致：`是 / 否`

### 测试结论
- [ ] 所有功能在重启后正常
- [ ] 数据保持一致
- [ ] 启动时间合理（< 30秒）

**问题记录**：`____`

---

## 任务4：application.yml配置检查

### 配置项检查表

| 配置项 | 当前值 | 是否规范 | 问题描述 | 建议值 | 优先级 |
|-------|-------|---------|---------|--------|--------|
| 数据库URL | `jdbc:mysql://...` | ✅/❌ | | | 高/中/低 |
| 数据库密码 | `123456` | ❌ | 硬编码 | 环境变量 | 高 |
| 最大线程数 | `200` | ✅/❌ | | | |
| 最小空闲线程 | `10` | ✅/❌ | | | |
| 最大连接数 | `10000` | ✅/❌ | | | |
| 文件大小限制 | `5MB` | ✅/❌ | | | |
| 日志级别 | `DEBUG` | ✅/❌ | | | |
| 跨域配置 | `*` | ❌ | 生产环境不安全 | 限制域名 | 中 |

### 配置问题汇总
1. **高优先级问题**：
   - `____`
   - `____`

2. **中优先级问题**：
   - `____`
   - `____`

3. **低优先级问题**：
   - `____`
   - `____`

### 测试结论
- [ ] 配置格式正确
- [ ] 配置值合理
- [ ] 敏感信息未硬编码
- [ ] 配置有注释说明

**问题记录**：`____`

---

## 任务5：文件上传/下载失败测试

### 上传失败测试

| 测试场景 | 测试文件 | 预期状态码 | 实际状态码 | 错误提示 | 是否友好 | 备注 |
|---------|---------|-----------|-----------|---------|---------|------|
| 文件过大 | >5MB文件 | 400/413 | | | ✅/❌ | |
| 文件类型不支持 | .exe文件 | 400 | | | ✅/❌ | |
| 空文件 | 0字节 | 400 | | | ✅/❌ | |
| 目录不存在 | 修改配置 | 500 | | | ✅/❌ | |

### 下载失败测试

| 测试场景 | 请求URL | 预期状态码 | 实际状态码 | 错误提示 | 备注 |
|---------|---------|-----------|-----------|---------|------|
| 文件不存在 | `/api/files/leave-proofs/nonexistent.jpg` | 404 | | | |
| 路径遍历 | `/api/files/leave-proofs/../../../etc/passwd` | 403/404 | | | |

### 测试结论
- [ ] 所有失败场景都有明确提示
- [ ] 错误信息对用户友好
- [ ] 没有泄露系统内部信息
- [ ] HTTP状态码使用正确

**问题记录**：`____`

---

## 任务6：日志完整性检查

### 日志检查表

| 日志类型 | 时间戳 | 日志级别 | 请求参数 | 错误堆栈 | 线程信息 | 类名方法 | 可读性评分 |
|---------|-------|---------|---------|---------|---------|---------|-----------|
| 正常请求 | ✅/❌ | ✅/❌ | ✅/❌ | N/A | ✅/❌ | ✅/❌ | ____/5 |
| 错误日志 | ✅/❌ | ✅/❌ | ✅/❌ | ✅/❌ | ✅/❌ | ✅/❌ | ____/5 |
| 警告日志 | ✅/❌ | ✅/❌ | ✅/❌ | N/A | ✅/❌ | ✅/❌ | ____/5 |

### 日志示例

**正常请求日志：**
```
[在此粘贴正常请求日志]
```

**错误日志：**
```
[在此粘贴错误日志]
```

### 日志定位测试
选择一个错误日志，尝试定位问题：
- [ ] 能确定错误发生时间：`是 / 否`
- [ ] 能确定是哪个接口：`是 / 否`
- [ ] 能确定请求参数：`是 / 否`
- [ ] 能确定错误原因：`是 / 否`
- [ ] 能根据堆栈找到代码位置：`是 / 否`

### 测试结论
- [ ] 日志格式统一
- [ ] 日志信息完整
- [ ] 易于定位问题
- [ ] 日志级别使用合理

**问题记录**：`____`

---

## 任务7：资源占用测试

### 资源占用记录表

| 测试阶段 | 时间 | CPU(%) | 内存(MB) | 线程数 | 备注 |
|---------|------|--------|---------|-------|------|
| 初始状态 | ____ | | | | 启动后1分钟 |
| 压力测试开始 | ____ | | | | |
| 压力测试峰值 | ____ | | | | |
| 压力测试结束 | ____ | | | | |
| 30分钟后 | ____ | | | | |

### 压力测试配置
- 测试工具：`Postman Runner / Apache Bench / 其他`
- 请求数量：`____`
- 并发数：`____`
- 测试接口：`____`

### 资源占用分析
- **内存占用是否合理**：`是 / 否`
  - 原因：`____`
  
- **线程数是否合理**：`是 / 否`
  - 原因：`____`
  
- **是否存在内存泄漏**：`是 / 否`
  - 证据：`____`

### 测试结论
- [ ] 资源占用在合理范围内
- [ ] 无内存泄漏
- [ ] 线程数正常
- [ ] CPU占用正常

**问题记录**：`____`

---

## 任务8：容错性测试

### 自动重试机制检查

| 重试场景 | 是否有机制 | 配置值 | 是否有效 | 备注 |
|---------|-----------|-------|---------|------|
| 数据库连接重试 | 是/否 | | 是/否 | |
| HTTP请求重试 | 是/否 | | 是/否 | |
| Redis连接重试 | 是/否 | | 是/否 | |

### 并发测试

| 测试场景 | 并发数 | 请求总数 | 成功数 | 失败数 | 平均响应时间 | 是否有死锁 |
|---------|-------|---------|-------|-------|------------|-----------|
| 并发查询 | | | | | | 是/否 |
| 并发写入 | | | | | | 是/否 |

### 超时配置检查

| 超时类型 | 配置值 | 是否合理 | 备注 |
|---------|-------|---------|------|
| 数据库连接超时 | 30000ms | ✅/❌ | |
| HTTP请求超时 | | ✅/❌ | |
| 事务超时 | | ✅/❌ | |

### 异常处理检查
- [ ] 有全局异常处理（@ControllerAdvice）
- [ ] Service层有try-catch
- [ ] 异常信息对用户友好
- [ ] 异常不会导致服务崩溃

### 测试结论
- [ ] 有自动重试机制
- [ ] 能正确处理并发请求
- [ ] 无死锁问题
- [ ] 超时配置合理

**问题记录**：`____`

---

## 任务9：可维护性分析

### 配置可维护性

**优点：**
- `____`
- `____`

**问题：**
- `____`
- `____`

**建议：**
- `____`
- `____`

### 日志可维护性

**优点：**
- `____`
- `____`

**问题：**
- `____`
- `____`

**建议：**
- `____`
- `____`

### 代码结构可维护性

**优点：**
- `____`
- `____`

**问题：**
- `____`
- `____`

**建议：**
- `____`
- `____`

### 总体评分
- 配置可维护性：`____/10分`
- 日志可维护性：`____/10分`
- 代码结构可维护性：`____/10分`
- **总体可维护性：`____/10分`**

---

## 任务10：问题汇总

### 高优先级问题

| 问题编号 | 问题描述 | 影响范围 | 建议解决方案 | 负责人 |
|---------|---------|---------|------------|--------|
| P1-1 | | | | |
| P1-2 | | | | |

### 中优先级问题

| 问题编号 | 问题描述 | 影响范围 | 建议解决方案 | 负责人 |
|---------|---------|---------|------------|--------|
| P2-1 | | | | |
| P2-2 | | | | |

### 低优先级问题

| 问题编号 | 问题描述 | 影响范围 | 建议解决方案 | 负责人 |
|---------|---------|---------|------------|--------|
| P3-1 | | | | |
| P3-2 | | | | |

---

## 测试总结

### 测试完成情况
- [ ] 任务1：数据库断开恢复测试
- [ ] 任务2：异常参数测试
- [ ] 任务3：服务重启恢复测试
- [ ] 任务4：配置检查
- [ ] 任务5：文件上传/下载测试
- [ ] 任务6：日志完整性检查
- [ ] 任务7：资源占用测试
- [ ] 任务8：容错性测试
- [ ] 任务9：可维护性分析
- [ ] 任务10：报告编写

### 总体评价
- **系统可靠性评分**：`____/10分`
- **系统可维护性评分**：`____/10分`
- **是否满足生产环境要求**：`是 / 否`

### 主要发现
1. `____`
2. `____`
3. `____`

### 改进建议
1. `____`
2. `____`
3. `____`

---

**测试完成日期**：____年____月____日  
**测试人员签名**：____


