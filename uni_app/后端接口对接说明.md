# æ‚£è€…ç«¯ - åç«¯æ¥å£å¯¹æ¥è¯´æ˜

## âœ… å·²å¯¹æ¥çš„æ¥å£ï¼ˆåŸºäºå®é™…åç«¯ä»£ç ï¼‰

### 1. éªŒè¯åˆå§‹ä¿¡æ¯ï¼ˆæ¿€æ´»ç¬¬ä¸€æ­¥ï¼‰
- **å‰ç«¯è°ƒç”¨**ï¼š`verifyInitialLogin()`
- **åç«¯æ¥å£**ï¼š`POST /api/auth/verify-patient`
- **åç«¯Controller**ï¼š`AuthController.verifyInitialInfo()`
- **è¯·æ±‚å‚æ•°**ï¼š
  ```javascript
  {
    identifier: "å­¦å·/å·¥å·",
    initialPassword: "åˆå§‹å¯†ç "
  }
  ```
- **æˆåŠŸå“åº”**ï¼š
  ```json
  {
    "message": "åˆå§‹ä¿¡æ¯éªŒè¯æˆåŠŸï¼Œè¯·ç»§ç»­èº«ä»½éªŒè¯"
  }
  ```
- **å¤±è´¥å“åº”**ï¼š
  ```json
  {
    "error": "å­¦å·/å·¥å·ä¸å­˜åœ¨"
  }
  ```
  æˆ–
  ```json
  {
    "error": "å…·ä½“é”™è¯¯ä¿¡æ¯"
  }
  ```

### 2. æ¿€æ´»è´¦æˆ·ï¼ˆæ¿€æ´»ç¬¬äºŒæ­¥ï¼‰
- **å‰ç«¯è°ƒç”¨**ï¼š`activatePatient()`
- **åç«¯æ¥å£**ï¼š`POST /api/auth/activate-patient`
- **åç«¯Controller**ï¼š`AuthController.activateAccount()`
- **è¯·æ±‚å‚æ•°**ï¼š
  ```javascript
  {
    identifier: "å­¦å·/å·¥å·",
    idCardEnding: "èº«ä»½è¯å6ä½",
    newPassword: "æ–°å¯†ç ",
    confirmPassword: "ç¡®è®¤å¯†ç "
  }
  ```
- **æˆåŠŸå“åº”**ï¼š
  ```json
  {
    "message": "è´¦æˆ·æ¿€æ´»æˆåŠŸï¼Œè¯·è¿”å›ç™»å½•"
  }
  ```
- **å¤±è´¥å“åº”**ï¼š
  ```json
  {
    "error": "å…·ä½“é”™è¯¯ä¿¡æ¯"
  }
  ```

## âš ï¸ å¾…å®ç°çš„æ¥å£ï¼ˆåç«¯æš‚æœªå®ç°ï¼‰

### 1. æ‚£è€…ç™»å½•
- **å‰ç«¯è°ƒç”¨**ï¼š`loginPatient()`
- **éœ€è¦çš„æ¥å£**ï¼š`POST /api/patient/login` æˆ– `/api/auth/login-patient`
- **å»ºè®®è¯·æ±‚å‚æ•°**ï¼š
  ```javascript
  {
    identifier: "å­¦å·/å·¥å·",
    password: "å¯†ç "
  }
  ```
- **å»ºè®®å“åº”æ ¼å¼**ï¼š
  ```json
  {
    "message": "ç™»å½•æˆåŠŸ",
    "token": "JWT Token",
    "patientInfo": {
      "patientId": "æ‚£è€…ID",
      "name": "å§“å",
      "phone": "æ‰‹æœºå·",
      "allergyHistory": "è¿‡æ•å²",
      "pastMedicalHistory": "æ—¢å¾€ç—…å²"
    }
  }
  ```

### 2. æ£€æŸ¥æ¿€æ´»çŠ¶æ€
- **å‰ç«¯è°ƒç”¨**ï¼š`checkActivationStatus(identifier)`
- **éœ€è¦çš„æ¥å£**ï¼š`GET /api/patient/activation-status/{identifier}`
- **å»ºè®®å“åº”æ ¼å¼**ï¼š
  ```json
  {
    "isActivated": true,
    "lastLoginTime": "2024-01-15 10:30:00"
  }
  ```

### 3. ç™»å‡º
- **å‰ç«¯è°ƒç”¨**ï¼š`logoutPatient()`
- **éœ€è¦çš„æ¥å£**ï¼š`POST /api/patient/logout`
- **è¯·æ±‚å¤´**ï¼š`Authorization: Bearer {token}`
- **å»ºè®®å“åº”æ ¼å¼**ï¼š
  ```json
  {
    "message": "ç™»å‡ºæˆåŠŸ"
  }
  ```

## ğŸ“‹ åç«¯æ¥å£å®ç°å»ºè®®

### å»ºè®®1ï¼šåœ¨ `AuthController` ä¸­æ·»åŠ ç™»å½•æ¥å£

```java
/**
 * æ‚£è€…ç™»å½•
 * URL: POST /api/auth/login-patient
 */
@PostMapping("/login-patient")
public ResponseEntity<?> loginPatient(@RequestBody LoginRequest request) {
    try {
        // è°ƒç”¨ Service éªŒè¯è´¦å·å¯†ç 
        PatientLoginResponse response = patientService.login(
            request.getIdentifier(),
            request.getPassword()
        );
        return ResponseEntity.ok().body(response);
    } catch (Exception e) {
        return ResponseEntity.badRequest()
            .body("{\"error\": \"" + e.getMessage() + "\"}");
    }
}
```

### å»ºè®®2ï¼šåˆ›å»ºå¯¹åº”çš„ DTO

**LoginRequest.java**
```java
public class LoginRequest {
    private String identifier;
    private String password;
    // getters and setters
}
```

**PatientLoginResponse.java**
```java
public class PatientLoginResponse {
    private String message;
    private String token;
    private PatientInfo patientInfo;
    // getters and setters
}
```

## ğŸ”„ å“åº”æ ¼å¼è¯´æ˜

ç›®å‰åç«¯ä½¿ç”¨ä¸¤ç§å“åº”æ ¼å¼ï¼š

### 1. ç®€å•æ ¼å¼ï¼ˆå½“å‰ AuthController ä½¿ç”¨ï¼‰
```json
{
  "message": "æˆåŠŸæ¶ˆæ¯"
}
```
æˆ–
```json
{
  "error": "é”™è¯¯æ¶ˆæ¯"
}
```

### 2. æ ‡å‡†æ ¼å¼ï¼ˆå¯ä»¥è€ƒè™‘ç»Ÿä¸€ä½¿ç”¨ï¼‰
```json
{
  "code": "200",
  "msg": "è¯·æ±‚æˆåŠŸ",
  "data": {}
}
```

**å»ºè®®**ï¼šä¸ºäº†ä¿æŒä¸€è‡´æ€§ï¼Œå¯ä»¥è€ƒè™‘å°†æ‰€æœ‰æ¥å£ç»Ÿä¸€ä½¿ç”¨ `BaseResponse` æ ¼å¼ã€‚

## ğŸ§ª æµ‹è¯•è¯´æ˜

### å½“å‰å¯æµ‹è¯•çš„åŠŸèƒ½
1. âœ… è´¦æˆ·æ¿€æ´» - ç¬¬ä¸€æ­¥ï¼šéªŒè¯åˆå§‹ä¿¡æ¯
2. âœ… è´¦æˆ·æ¿€æ´» - ç¬¬äºŒæ­¥ï¼šèº«ä»½éªŒè¯å¹¶è®¾ç½®æ–°å¯†ç 

### æš‚æ—¶æ— æ³•æµ‹è¯•çš„åŠŸèƒ½
1. âŒ æ­£å¸¸ç™»å½•ï¼ˆæ¥å£æœªå®ç°ï¼‰
2. âŒ ç™»å‡ºï¼ˆæ¥å£æœªå®ç°ï¼‰
3. âŒ æ£€æŸ¥æ¿€æ´»çŠ¶æ€ï¼ˆæ¥å£æœªå®ç°ï¼‰

## ğŸ“ å‰åç«¯å‚æ•°å¯¹ç…§è¡¨

| åŠŸèƒ½ | å‰ç«¯å‚æ•°å | åç«¯å‚æ•°å | è¯´æ˜ |
|------|-----------|-----------|------|
| éªŒè¯åˆå§‹ä¿¡æ¯ | identifier | identifier | å­¦å·/å·¥å· |
| éªŒè¯åˆå§‹ä¿¡æ¯ | initialPassword | initialPassword | åˆå§‹å¯†ç  |
| æ¿€æ´»è´¦æˆ· | identifier | identifier | å­¦å·/å·¥å· |
| æ¿€æ´»è´¦æˆ· | idCardEnding | idCardEnding | èº«ä»½è¯å6ä½ |
| æ¿€æ´»è´¦æˆ· | newPassword | newPassword | æ–°å¯†ç  |
| æ¿€æ´»è´¦æˆ· | confirmPassword | confirmPassword | ç¡®è®¤å¯†ç  |

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### å¯åŠ¨åç«¯
```bash
cd springboot
# å¯åŠ¨ Spring Boot åº”ç”¨
```

### å¯åŠ¨å‰ç«¯
```bash
cd uni_app
npm install
npm run dev:mp-weixin
```

### æµ‹è¯•æ¿€æ´»åŠŸèƒ½
1. åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­æ‰“å¼€ç¼–è¯‘åçš„å°ç¨‹åº
2. ç‚¹å‡»"é¦–æ¬¡ä½¿ç”¨ï¼Ÿç‚¹å‡»æ¿€æ´»è´¦æˆ·"
3. è¾“å…¥å­¦å·å’Œåˆå§‹å¯†ç ï¼ˆæ ¹æ®æ•°æ®åº“ä¸­çš„æµ‹è¯•æ•°æ®ï¼‰
4. è¾“å…¥èº«ä»½è¯å6ä½å’Œæ–°å¯†ç 
5. å®Œæˆæ¿€æ´»

## âš¡ ä¸‹ä¸€æ­¥å·¥ä½œ

1. åç«¯å®ç°æ‚£è€…ç™»å½•æ¥å£
2. åç«¯å®ç°JWT Tokenç”Ÿæˆå’ŒéªŒè¯
3. åç«¯å®ç°ç™»å‡ºæ¥å£
4. å‰ç«¯å¯¹æ¥ç™»å½•æ¥å£
5. æ·»åŠ è·¯ç”±å®ˆå«éªŒè¯ç™»å½•çŠ¶æ€

