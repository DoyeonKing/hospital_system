# 管理员权限动态显示功能 - 配置说明

## 一、数据库实际配置

### 1. 角色表 (roles)
```
role_id=1: super_admin (超级管理员，拥有所有权限)
role_id=2: medical_admin (医务管理员，管理医生和排班)
role_id=3: financial_admin (财务管理员，管理财务和报表)
role_id=4: patient_admin (患者管理员，管理患者信息)
role_id=5: system_operator (系统操作员，日常运维)
```

### 2. 管理员-角色映射 (admin_roles)
```
admin_id=1 → role_id=1 (超级管理员)
admin_id=2 → role_id=4 (患者管理员)
admin_id=3 → role_id=5 (系统操作员)
admin_id=5 → role_id=2 (医务管理员) + role_id=3 (财务管理员)
```

### 3. 权限表 (permissions)
```
1. user_manage - 用户管理权限
2. doctor_manage - 医生管理权限
3. patient_manage - 患者管理权限
4. schedule_manage - 排班管理权限
5. appointment_manage - 预约管理权限
6. financial_manage - 财务管理权限
7. medical_guide_manage - 就医规范管理权限
8. system_config - 系统配置权限
9. audit_log_view - 审计日志查看权限
10. report_generate - 报表生成权限
```

### 4. 角色-权限映射 (role_permissions)
```
role_id=1 (超级管理员): 拥有所有10个权限
role_id=2 (医务管理员): doctor_manage, schedule_manage, appointment_manage, audit_log_view
role_id=3 (财务管理员): financial_manage, report_generate
role_id=4 (患者管理员): patient_manage, appointment_manage, audit_log_view
role_id=5 (系统操作员): schedule_manage, appointment_manage, audit_log_view
```

## 二、功能卡片权限映射

| 功能卡片 | 所需权限 | admin_id=1 | admin_id=2 | admin_id=3 | admin_id=5 |
|---------|---------|-----------|-----------|-----------|-----------|
| 数据大屏 | `audit_log_view` 或 `report_generate` | ✅ | ✅ | ✅ | ✅ |
| 科室信息管理 | `doctor_manage` | ✅ | ❌ | ❌ | ✅ |
| 用户账户管理 | `user_manage` | ✅ | ❌ | ❌ | ❌ |
| 排班管理 | `schedule_manage` | ✅ | ❌ | ✅ | ✅ |
| 号别管理 | `schedule_manage` 或 `financial_manage` | ✅ | ❌ | ✅ | ✅ |
| 就医规范管理 | `medical_guide_manage` | ✅ | ❌ | ❌ | ❌ |
| 医生工时统计 | `report_generate` | ✅ | ❌ | ❌ | ✅ |
| 患者签到 | `appointment_manage` | ✅ | ✅ | ✅ | ✅ |
| 请假审批 | `schedule_manage` | ✅ | ❌ | ✅ | ✅ |
| 加号审批 | `schedule_manage` 或 `appointment_manage` | ✅ | ✅ | ✅ | ✅ |
| 现场服务 | `appointment_manage` 或 `patient_manage` | ✅ | ✅ | ✅ | ✅ |

## 三、各管理员看到的功能卡片

### admin_id=1 (超级管理员)
**拥有权限**: 全部10个权限
**看到的卡片**: 全部11个功能卡片
- ✅ 数据大屏
- ✅ 科室信息管理
- ✅ 用户账户管理
- ✅ 排班管理
- ✅ 号别管理
- ✅ 就医规范管理
- ✅ 医生工时统计
- ✅ 患者签到
- ✅ 请假审批
- ✅ 加号审批
- ✅ 现场服务

### admin_id=2 (患者管理员)
**拥有权限**: `patient_manage`, `appointment_manage`, `audit_log_view`
**看到的卡片**: 4个
- ✅ 数据大屏
- ✅ 患者签到
- ✅ 加号审批
- ✅ 现场服务

### admin_id=3 (系统操作员)
**拥有权限**: `schedule_manage`, `appointment_manage`, `audit_log_view`
**看到的卡片**: 7个
- ✅ 数据大屏
- ✅ 排班管理
- ✅ 号别管理
- ✅ 患者签到
- ✅ 请假审批
- ✅ 加号审批
- ✅ 现场服务

### admin_id=5 (医务管理员 + 财务管理员)
**拥有权限**: `doctor_manage`, `schedule_manage`, `appointment_manage`, `audit_log_view`, `financial_manage`, `report_generate`
**看到的卡片**: 9个
- ✅ 数据大屏
- ✅ 科室信息管理
- ✅ 排班管理
- ✅ 号别管理
- ✅ 医生工时统计
- ✅ 患者签到
- ✅ 请假审批
- ✅ 加号审批
- ✅ 现场服务

## 四、API 接口

### 1. 获取管理员权限
```
GET /api/admin/{adminId}/permissions
```

**响应示例**:
```json
{
  "code": "200",
  "msg": "success",
  "data": [
    "doctor_manage",
    "schedule_manage",
    "appointment_manage",
    "audit_log_view",
    "financial_manage",
    "report_generate"
  ]
}
```

### 2. 获取管理员详细权限信息
```
GET /api/admin/{adminId}/permissions/details
```

**响应示例**:
```json
{
  "code": "200",
  "msg": "success",
  "data": [
    {
      "permissionId": 2,
      "permissionName": "doctor_manage",
      "description": "医生管理权限"
    },
    {
      "permissionId": 4,
      "permissionName": "schedule_manage",
      "description": "排班管理权限"
    }
  ]
}
```

## 五、前端使用方法

### 1. 在组件中检查权限
```javascript
import { useAdminStore } from '@/stores/adminStore';

const adminStore = useAdminStore();

// 检查单个权限
const hasPermission = (permissionName) => {
  return adminStore.hasPermission(permissionName);
};

// 检查是否拥有任意一个权限
const hasAnyPermission = (permissionNames) => {
  return adminStore.hasAnyPermission(permissionNames);
};

// 检查是否拥有所有权限
const hasAllPermissions = (permissionNames) => {
  return adminStore.hasAllPermissions(permissionNames);
};
```

### 2. 在模板中使用
```vue
<!-- 单个权限 -->
<router-link v-if="hasPermission('doctor_manage')" to="/departments">
  科室管理
</router-link>

<!-- 多个权限（任意一个） -->
<router-link v-if="hasAnyPermission(['schedule_manage', 'financial_manage'])" to="/fee-management">
  号别管理
</router-link>

<!-- 多个权限（全部） -->
<router-link v-if="hasAllPermissions(['doctor_manage', 'schedule_manage'])" to="/advanced">
  高级功能
</router-link>
```

## 六、测试步骤

1. **启动后端服务**
2. **启动前端服务**
3. **使用不同管理员登录测试**:
   - admin_id=1: 应该看到所有11个卡片
   - admin_id=2: 应该看到4个卡片
   - admin_id=3: 应该看到7个卡片
   - admin_id=5: 应该看到9个卡片

4. **查看浏览器控制台日志**:
   - 登录时会输出权限加载日志
   - 进入首页时会输出当前权限列表

## 七、注意事项

1. **前端权限控制只是UI层面的隐藏**，后端路由也需要添加权限验证
2. **权限缓存**：登录后权限会缓存在 Pinia store 中
3. **权限刷新**：如果管理员权限变更，需要重新登录才能生效
4. **超级管理员**：建议始终显示所有功能，不受权限限制
5. **权限为空**：如果管理员没有任何角色，将看不到任何功能卡片（除非特殊处理）
