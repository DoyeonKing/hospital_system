# æŒ‚å·è´¹æ˜¾ç¤ºä¿®å¤

## é—®é¢˜ç°è±¡

ä»æˆªå›¾çœ‹åˆ°ï¼š
- å¾…æ”¯ä»˜å¡ç‰‡æ˜¾ç¤ºï¼š**æŒ‚å·è´¹ï¼šÂ¥0**
- å®é™…åº”è¯¥æ˜¾ç¤ºæ­£ç¡®çš„æŒ‚å·è´¹é‡‘é¢ï¼ˆå¦‚ Â¥50ï¼‰

## é—®é¢˜åŸå› 

### æ•°æ®é€‚é…å™¨ç¼ºå°‘ fee å­—æ®µ

**æ–‡ä»¶**ï¼š`uni_app/utils/dataAdapter.js`

**é—®é¢˜**ï¼š`adaptAppointment` å‡½æ•°åœ¨è½¬æ¢é¢„çº¦æ•°æ®æ—¶ï¼Œæ²¡æœ‰åŒ…å« `fee`ï¼ˆæŒ‚å·è´¹ï¼‰å­—æ®µã€‚

**åŸä»£ç **ï¼ˆç¬¬101-118è¡Œï¼‰ï¼š
```javascript
const adapted = {
    id: appointment.appointmentId,
    appointmentId: appointment.appointmentId,
    scheduleId: schedule.scheduleId,
    // ... å…¶ä»–å­—æ®µ
    patientName: patient.fullName || patient.name || '',
    patientId: patient.patientId || patient.id
    // âŒ ç¼ºå°‘ fee å­—æ®µ
    // âŒ ç¼ºå°‘ paymentDeadline å­—æ®µ
}
```

**ç»“æœ**ï¼š
- `appointment.fee` ä¸º `undefined`
- æ¨¡æ¿ä¸­ `{{ appointment.fee || 0 }}` æ˜¾ç¤ºä¸º `0`

## ä¿®å¤æ–¹æ¡ˆ

### æ·»åŠ  fee å’Œ paymentDeadline å­—æ®µ

**æ–‡ä»¶**ï¼š`uni_app/utils/dataAdapter.js`

**ä¿®æ”¹ä½ç½®**ï¼šç¬¬118-119è¡Œ

**ä¿®æ”¹å**ï¼š
```javascript
const adapted = {
    id: appointment.appointmentId,
    appointmentId: appointment.appointmentId,
    scheduleId: schedule.scheduleId,
    departmentId: schedule.departmentId,
    departmentName: schedule.departmentName || '',
    doctorId: schedule.doctorId,
    doctorName: schedule.doctorName || '',
    doctorTitle: schedule.doctorTitle || '',
    scheduleTime: scheduleTime,
    scheduleEndTime: scheduleEndTime,
    appointmentTime: appointment.createdAt || '',
    status: finalStatus,
    queueNumber: appointment.appointmentNumber,
    appointmentNumber: appointment.appointmentNumber,
    patientName: patient.fullName || patient.name || '',
    patientId: patient.patientId || patient.id,
    fee: parseFloat(schedule.fee || 0),              // âœ… æ–°å¢
    paymentDeadline: appointment.paymentDeadline || '' // âœ… æ–°å¢
}
```

### ä¸ºä»€ä¹ˆä» schedule è·å– feeï¼Ÿ

åç«¯æ•°æ®ç»“æ„ï¼š
```json
{
    "appointmentId": 123,
    "schedule": {
        "scheduleId": 456,
        "fee": 50.00,  // â† æŒ‚å·è´¹åœ¨ schedule å¯¹è±¡ä¸­
        "doctorName": "æäºšæ¥ ",
        "departmentName": "å‘¼å¸å†…ç§‘"
    },
    "paymentDeadline": "2025-11-28T21:36:00"  // â† æ”¯ä»˜æˆªæ­¢æ—¶é—´åœ¨ appointment ä¸­
}
```

## éªŒè¯ä¿®æ”¹

### 1. é‡æ–°ç¼–è¯‘
```bash
cd d:\BJTU5\hospital_system\uni_app
npm run dev:mp-weixin
```

### 2. æ¸…é™¤ç¼“å­˜
åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­ï¼š
- å·¥å…· â†’ æ¸…é™¤ç¼“å­˜ â†’ æ¸…é™¤æ‰€æœ‰ç¼“å­˜

### 3. åˆ·æ–°é¡µé¢
- å…³é—­å½“å‰é¢„çº¦è¯¦æƒ…é¡µ
- é‡æ–°è¿›å…¥é¢„çº¦è¯¦æƒ…é¡µ

### 4. é¢„æœŸæ•ˆæœ

å¾…æ”¯ä»˜å¡ç‰‡åº”è¯¥æ˜¾ç¤ºï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ’°  å¾…æ”¯ä»˜                           â”‚
â”‚     è¯·å°½å¿«å®Œæˆæ”¯ä»˜ä»¥ç¡®è®¤é¢„çº¦          â”‚
â”‚     æŒ‚å·è´¹ï¼šÂ¥50.00  â† âœ… æ˜¾ç¤ºæ­£ç¡®é‡‘é¢ â”‚
â”‚     æ”¯ä»˜æˆªæ­¢ï¼š11æœˆ28æ—¥ 21:36         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## è°ƒè¯•æ–¹æ³•

### æŸ¥çœ‹æ•°æ®

åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·çš„æ§åˆ¶å°è¾“å…¥ï¼š
```javascript
// æŸ¥çœ‹é¢„çº¦æ•°æ®
console.log('é¢„çº¦æ•°æ®:', this.appointment)

// æŸ¥çœ‹è´¹ç”¨
console.log('æŒ‚å·è´¹:', this.appointment.fee)

// æŸ¥çœ‹æ”¯ä»˜æˆªæ­¢æ—¶é—´
console.log('æ”¯ä»˜æˆªæ­¢:', this.appointment.paymentDeadline)
```

**é¢„æœŸè¾“å‡º**ï¼š
```
é¢„çº¦æ•°æ®: {
    appointmentId: 123,
    fee: 50,
    paymentDeadline: "2025-11-28T21:36:00",
    ...
}
æŒ‚å·è´¹: 50
æ”¯ä»˜æˆªæ­¢: 2025-11-28T21:36:00
```

### å¦‚æœè¿˜æ˜¯æ˜¾ç¤º Â¥0

å¯èƒ½çš„åŸå› ï¼š
1. **åç«¯æ²¡æœ‰è¿”å› fee**
   - æ£€æŸ¥åç«¯ API å“åº”
   - ç¡®è®¤ `schedule.fee` å­—æ®µå­˜åœ¨

2. **ç¼“å­˜æ²¡æœ‰æ¸…é™¤**
   - å®Œå…¨å…³é—­å¾®ä¿¡å¼€å‘è€…å·¥å…·
   - åˆ é™¤ç¼–è¯‘äº§ç‰©ï¼š`rd /s /q dist`
   - é‡æ–°ç¼–è¯‘

3. **æ•°æ®ç±»å‹é—®é¢˜**
   - `parseFloat(schedule.fee || 0)` ç¡®ä¿è½¬æ¢ä¸ºæ•°å­—
   - å¦‚æœ `schedule.fee` æ˜¯å­—ç¬¦ä¸²ï¼Œä¼šè‡ªåŠ¨è½¬æ¢

## åç«¯æ•°æ®æ£€æŸ¥

### SQL æŸ¥è¯¢

æ£€æŸ¥æ’ç­çš„æŒ‚å·è´¹ï¼š
```sql
SELECT 
    s.schedule_id,
    s.fee,
    d.name AS doctor_name,
    dept.name AS department_name
FROM schedules s
JOIN doctors d ON s.doctor_id = d.doctor_id
JOIN departments dept ON d.department_id = dept.department_id
WHERE s.schedule_id = ?;
```

### API å“åº”æ£€æŸ¥

æ£€æŸ¥é¢„çº¦è¯¦æƒ… API çš„å“åº”ï¼š
```
GET /api/appointments/{appointmentId}

Response:
{
    "appointmentId": 123,
    "schedule": {
        "scheduleId": 456,
        "fee": 50.00,  â† ç¡®è®¤è¿™ä¸ªå­—æ®µå­˜åœ¨
        ...
    },
    "paymentDeadline": "2025-11-28T21:36:00",
    ...
}
```

## ç›¸å…³ä»£ç ä½ç½®

### 1. æ•°æ®é€‚é…å™¨
**æ–‡ä»¶**ï¼š`uni_app/utils/dataAdapter.js`
**è¡Œå·**ï¼š118-119
```javascript
fee: parseFloat(schedule.fee || 0),
paymentDeadline: appointment.paymentDeadline || ''
```

### 2. å‰ç«¯æ˜¾ç¤º
**æ–‡ä»¶**ï¼š`uni_app/pages/appointment/detail.vue`
**è¡Œå·**ï¼š74
```vue
<text class="payment-fee">æŒ‚å·è´¹ï¼šÂ¥{{ appointment.fee || 0 }}</text>
```

### 3. æ”¯ä»˜æˆªæ­¢æ—¶é—´æ˜¾ç¤º
**æ–‡ä»¶**ï¼š`uni_app/pages/appointment/detail.vue`
**è¡Œå·**ï¼š75-77
```vue
<text class="payment-deadline" v-if="appointment.paymentDeadline">
    æ”¯ä»˜æˆªæ­¢ï¼š{{ formatDateTime(appointment.paymentDeadline) }}
</text>
```

## æ•°æ®æµ

```
åç«¯ API
  â†“
{
  appointmentId: 123,
  schedule: {
    fee: 50.00  â† æŒ‚å·è´¹
  },
  paymentDeadline: "2025-11-28T21:36:00"
}
  â†“
dataAdapter.js
  â†“
{
  appointmentId: 123,
  fee: 50,  â† âœ… æå–åˆ°é¡¶å±‚
  paymentDeadline: "2025-11-28T21:36:00"
}
  â†“
detail.vue
  â†“
æ˜¾ç¤ºï¼šæŒ‚å·è´¹ï¼šÂ¥50.00
```

## å…¶ä»–éœ€è¦ fee çš„åœ°æ–¹

### 1. æ”¯ä»˜ç¡®è®¤å¯¹è¯æ¡†
**æ–‡ä»¶**ï¼š`detail.vue` ç¬¬643è¡Œ
```javascript
content: `ä½¿ç”¨${selectedMethod.name}æ”¯ä»˜ Â¥${this.appointment.fee || 0}ï¼Ÿ`
```

### 2. é¢„çº¦åˆ—è¡¨
å¦‚æœé¢„çº¦åˆ—è¡¨ä¹Ÿéœ€è¦æ˜¾ç¤ºè´¹ç”¨ï¼Œéœ€è¦æ£€æŸ¥ï¼š
- `uni_app/pages/appointments/appointments.vue`
- ç¡®ä¿åˆ—è¡¨æ•°æ®ä¹ŸåŒ…å« `fee` å­—æ®µ

## æ€»ç»“

### é—®é¢˜
æ•°æ®é€‚é…å™¨ç¼ºå°‘ `fee` å’Œ `paymentDeadline` å­—æ®µï¼Œå¯¼è‡´æŒ‚å·è´¹æ˜¾ç¤ºä¸º Â¥0ã€‚

### ä¿®å¤
åœ¨ `adaptAppointment` å‡½æ•°ä¸­æ·»åŠ è¿™ä¸¤ä¸ªå­—æ®µï¼š
- `fee`: ä» `schedule.fee` è·å–
- `paymentDeadline`: ä» `appointment.paymentDeadline` è·å–

### å½±å“
- âœ… æŒ‚å·è´¹æ­£ç¡®æ˜¾ç¤º
- âœ… æ”¯ä»˜æˆªæ­¢æ—¶é—´æ­£ç¡®æ˜¾ç¤º
- âœ… æ”¯ä»˜ç¡®è®¤å¯¹è¯æ¡†æ˜¾ç¤ºæ­£ç¡®é‡‘é¢
- âœ… ä¸å½±å“å…¶ä»–åŠŸèƒ½

### æµ‹è¯•
é‡æ–°ç¼–è¯‘åï¼Œå¾…æ”¯ä»˜é¡µé¢åº”è¯¥æ˜¾ç¤ºæ­£ç¡®çš„æŒ‚å·è´¹é‡‘é¢ã€‚

---

**ä¿®æ”¹æ–‡ä»¶**ï¼š
1. âœ… `uni_app/utils/dataAdapter.js` - æ·»åŠ  fee å’Œ paymentDeadline å­—æ®µ

**éœ€è¦æ“ä½œ**ï¼š
1. é‡æ–°ç¼–è¯‘å‰ç«¯
2. æ¸…é™¤ç¼“å­˜
3. åˆ·æ–°é¡µé¢
4. éªŒè¯æŒ‚å·è´¹æ˜¾ç¤ºæ­£ç¡®

ç°åœ¨æŒ‚å·è´¹åº”è¯¥èƒ½æ­£ç¡®æ˜¾ç¤ºäº†ï¼ğŸ’°
