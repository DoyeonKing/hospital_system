# 🧪 地图导航功能测试流程指南

## 📋 准备工作

### 1. 确认项目环境
- ✅ 已安装 Node.js
- ✅ 已安装 HBuilderX 或配置好开发环境
- ✅ 高德地图 API Key 已配置（`3666a62235f1d9d6aa75c0e3590dc009`）

### 2. 选择测试平台

根据你的开发环境，可以选择以下平台之一进行测试：

- **微信小程序**（推荐）- 需要微信开发者工具
- **H5网页** - 浏览器测试（地图功能可能受限）
- **APP** - 需要打包后安装到手机

---

## 🚀 方式一：微信小程序测试（推荐）

### 步骤 1：启动开发服务器

打开终端，进入项目目录：

```bash
cd E:\hospital_system\uni_app
npm run dev:mp-weixin
```

或者如果你使用的是 HBuilderX：
1. 用 HBuilderX 打开 `uni_app` 文件夹
2. 点击菜单：运行 → 运行到小程序模拟器 → 微信开发者工具

### 步骤 2：打开微信开发者工具

1. 启动微信开发者工具
2. 选择导入项目
3. 项目目录选择：`E:\hospital_system\uni_app\unpackage\dist\dev\mp-weixin`
4. AppID：`wx163a1fc0af4eee09`（已在配置中）

### 步骤 3：访问导航页面

#### 方法 A：通过首页进入（推荐）

1. **进入首页**
   - 在模拟器中找到并点击"首页"标签
   - 或滚动首页内容

2. **找到导航入口**
   - 首页应该有导航功能入口
   - 如果没有，可以手动添加（见下方"添加入口"部分）

3. **点击导航按钮**进入导航页面

#### 方法 B：直接访问页面（调试模式）

在微信开发者工具中：

1. 点击右上角"编译"按钮旁边的"详情"
2. 在"本地设置"中开启"不校验合法域名"
3. 在页面路径中直接输入：`pages/navigation/NavigationMain`
4. 点击"编译"按钮

或者修改 `app.json` 的首页路径为导航页面（临时测试）：

```json
{
  "pages": [
    "pages/navigation/NavigationMain"  // 临时设为首页
  ]
}
```

### 步骤 4：测试地图功能

进入导航页面后，按以下步骤测试：

#### ✅ 测试点 1：位置权限授权

**预期行为：**
- 页面加载时，会弹出"获取位置权限"的提示
- 点击"允许"后，会显示定位中的提示

**如果没弹出：**
- 检查微信开发者工具的"设置" → "安全" → 是否开启了定位权限
- 或手动点击"扫码定位"按钮触发权限请求

#### ✅ 测试点 2：地图显示

**预期行为：**
- 地图正常显示（默认显示北京天安门附近）
- 地图可以拖动、缩放

**测试操作：**
- 双指缩放地图
- 单指拖动地图

**如果地图不显示：**
- 检查控制台是否有错误信息
- 确认高德地图 Key 是否正确配置

#### ✅ 测试点 3：获取当前位置

**预期行为：**
- 点击"📍 获取当前位置"（如果有按钮）
- 或者页面自动获取位置
- 地图中心移动到你的位置
- 显示一个标记点表示"我的位置"

**测试操作：**
1. 等待页面自动定位
2. 或点击页面上的位置按钮

**如果定位失败：**
- 检查是否允许了位置权限
- 模拟器可能无法获取真实位置，会使用默认位置
- 查看控制台错误信息

#### ✅ 测试点 4：地图标记点

**预期行为：**
- 地图上显示用户位置标记（绿色点）
- 如果有目标位置，显示目标位置标记（红色点）
- 点击标记可以查看详情

**测试操作：**
- 点击地图上的标记点
- 查看是否显示标注信息

#### ✅ 测试点 5：导航功能按钮

**预期行为：**
- 页面底部有操作按钮：
  - "扫码定位" 📷
  - "选择位置" 📍
  - "开始导航"（如果有目标）

**测试操作：**
1. 点击"扫码定位"按钮
2. 点击"选择位置"按钮
3. 查看是否正常跳转到对应页面

---

## 🌐 方式二：H5网页测试

### 步骤 1：启动H5开发服务器

```bash
cd E:\hospital_system\uni_app
npm run dev:h5
```

### 步骤 2：打开浏览器

访问显示的本地地址（通常是 `http://localhost:3000`）

### 步骤 3：访问导航页面

在浏览器地址栏输入：
```
http://localhost:3000/#/pages/navigation/NavigationMain
```

或者：
```
http://localhost:3000/#/pages/navigation/MapExample
```

### 步骤 4：测试功能

⚠️ **注意**：H5平台的地图功能可能受限，建议使用微信小程序或APP测试。

---

## 📱 方式三：使用示例页面测试（最简单）

我已经为你创建了一个简单的示例页面 `MapExample.vue`，可以快速测试地图功能。

### 步骤 1：添加示例页面到路由

编辑 `pages.json`，添加示例页面配置（如果还没有）：

```json
{
  "path": "pages/navigation/MapExample",
  "style": {
    "navigationBarTitleText": "地图示例",
    "navigationBarBackgroundColor": "#4FD9C3",
    "navigationBarTextStyle": "white"
  }
}
```

### 步骤 2：访问示例页面

在微信开发者工具中，页面路径输入：`pages/navigation/MapExample`

### 步骤 3：测试按钮

示例页面有以下按钮：
- **📍 获取当前位置** - 测试定位功能
- **🗺️ 重置地图** - 重置到默认位置
- **➕ 添加标记** - 在地图中心添加标记点

---

## 🔍 详细测试清单

### 基础功能测试

- [ ] **页面加载**
  - 页面能正常打开
  - 地图组件正常渲染
  - 无报错信息

- [ ] **位置获取**
  - 点击"获取位置"按钮
  - 弹出位置权限请求（第一次）
  - 成功获取位置后，地图中心移动到当前位置
  - 显示位置坐标信息

- [ ] **地图交互**
  - 可以拖动地图
  - 可以缩放地图（双指）
  - 地图标记点正常显示

- [ ] **标记点功能**
  - 用户位置标记显示
  - 点击标记显示标注信息
  - 添加新标记点功能正常

### 导航功能测试

- [ ] **室外导航**
  - 地图显示用户位置
  - 显示目标位置（如果有）
  - 显示导航路线（polyline）

- [ ] **按钮功能**
  - "扫码定位"按钮可点击
  - "选择位置"按钮可点击
  - 按钮点击后正确跳转

### 错误处理测试

- [ ] **权限拒绝**
  - 拒绝位置权限后，显示友好提示
  - 可以使用备用方案（手动选择位置）

- [ ] **定位失败**
  - 定位失败时显示错误提示
  - 使用默认位置继续显示地图

---

## 🐛 常见问题排查

### 问题 1：页面打不开

**解决方案：**
1. 检查编译是否成功
2. 查看控制台错误信息
3. 确认页面路径是否正确

### 问题 2：地图不显示

**解决方案：**
1. 检查 `manifest.json` 中高德地图 Key 配置
2. 查看浏览器控制台网络请求
3. 确认高德地图 Key 是否有效

### 问题 3：定位失败

**解决方案：**
1. **微信小程序**：
   - 在微信开发者工具中：设置 → 安全 → 开启定位权限
   - 或在手机上测试（真机预览）

2. **H5**：
   - 浏览器需要 HTTPS 才能获取位置
   - 或在本地测试时使用 `localhost`

3. **检查权限**：
   - 确认已授权位置权限
   - 检查设备定位是否开启

### 问题 4：地图位置不准

**解决方案：**
1. 确认使用了 `type: 'gcj02'` 坐标系
2. 检查高德地图 Key 配置
3. 在真机上测试（模拟器位置可能不准确）

---

## 📝 快速测试步骤（简化版）

### 最快速测试方法：

1. **打开微信开发者工具**
2. **导入项目**：`E:\hospital_system\uni_app\unpackage\dist\dev\mp-weixin`
3. **编译项目**
4. **在页面路径输入**：`pages/navigation/MapExample`
5. **点击编译**
6. **测试按钮**：
   - 点击"📍 获取当前位置"
   - 查看地图是否移动
   - 查看位置信息是否显示

---

## 🎯 预期测试结果

### 成功标志：

✅ **地图正常显示** - 能看到地图界面  
✅ **定位成功** - 能看到"定位成功"的提示  
✅ **地图中心移动** - 地图中心移动到你的位置（或默认位置）  
✅ **标记点显示** - 地图上显示位置标记点  
✅ **信息显示** - 显示经纬度坐标信息  

### 如果看到这些，说明功能正常！🎉

---

## 📞 下一步

测试通过后，你可以：

1. **配置实际医院坐标** - 修改 `NavigationMain.vue` 中的 `hospitalLocation`
2. **完善导航流程** - 测试完整的室外到室内导航切换
3. **测试扫码功能** - 测试二维码定位功能
4. **测试路径规划** - 等待后端接口完成后测试路径规划

---

## 🆘 需要帮助？

如果测试过程中遇到问题：

1. 查看浏览器/微信开发者工具的控制台错误信息
2. 检查 `uni_app/docs/地图使用说明.md` 文档
3. 确认高德地图 Key 配置正确
4. 尝试在真机上测试（模拟器可能有限制）



