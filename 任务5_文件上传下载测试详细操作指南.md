# 任务5：文件上传/下载测试详细操作指南

## 📋 准备工作

### 1. 确认服务运行
- ✅ Spring Boot服务已启动（http://localhost:8080）
- ✅ Postman已打开

### 2. 准备测试文件
在电脑上创建以下测试文件（可以放在桌面或任意文件夹）：

**需要准备的文件：**
1. **正常文件**：一个小图片（如 `test.jpg`，小于5MB）
2. **大文件**：一个超过5MB的文件（如 `bigfile.jpg`，大于5MB）
3. **不支持的文件**：一个 `.exe` 文件（如 `test.exe`）
4. **空文件**：创建一个空的文本文件 `empty.txt`（0字节）

**创建空文件的方法：**
- 在桌面右键 → 新建 → 文本文档
- 命名为 `empty.txt`
- 打开文件，**不要输入任何内容**，直接保存关闭

---

## 🚀 第一部分：测试文件上传

### 场景1：测试文件过大（超过5MB）

#### 步骤1：在Postman中创建新请求
1. 点击左侧 **"Collections"** 旁边的 **"+"** 号（或点击 "New"）
2. 选择 **"HTTP Request"**
3. 在请求名称处输入：`文件上传测试-大文件`

#### 步骤2：配置请求
1. **选择HTTP方法**：点击下拉框，选择 **"POST"**
2. **输入URL**：`{{base_url}}/api/upload`
   - 如果环境变量已配置，会自动替换为 `http://localhost:8080/api/upload`
   - 如果没有配置，直接输入：`http://localhost:8080/api/upload`

#### 步骤3：配置请求Body（关键步骤）
1. 点击 **"Body"** 标签（在URL下方）
2. 选择 **"form-data"**（不是raw，不是JSON）
3. 在表格中：
   - **Key列**：输入 `file`
   - **Key右侧的下拉框**：点击下拉，选择 **"File"**（不是Text！）
   - **Value列**：点击 **"Select Files"** 按钮
   - 选择你准备的大文件（超过5MB的文件）

#### 步骤4：发送请求
1. 点击右上角的蓝色 **"Send"** 按钮
2. 等待响应

#### 步骤5：记录结果
在下方响应区域查看：
- **状态码**：应该是 `400` 或 `413`
- **响应内容**：查看错误信息
- **记录到表格**：
  | 测试场景 | 预期状态码 | 实际状态码 | 错误提示 | 是否友好 |
  |---------|-----------|-----------|---------|---------|
  | 文件过大 | 400/413 | ____ | ____ | ✅/❌ |

---

### 场景2：测试文件类型不支持（.exe文件）

#### 步骤1：使用刚才的请求
- 在Postman中，点击刚才创建的请求（或创建新请求）

#### 步骤2：配置请求
1. **HTTP方法**：`POST`
2. **URL**：`{{base_url}}/api/upload` 或 `http://localhost:8080/api/upload`

#### 步骤3：配置Body
1. 点击 **"Body"** 标签
2. 选择 **"form-data"**
3. 在表格中：
   - **Key**：`file`
   - **Key右侧下拉框**：选择 **"File"**
   - **Value**：点击 **"Select Files"**，选择 `.exe` 文件

#### 步骤4：发送并记录
1. 点击 **"Send"**
2. 记录结果：
   | 测试场景 | 预期状态码 | 实际状态码 | 错误提示 | 是否友好 |
   |---------|-----------|-----------|---------|---------|
   | 文件类型不支持 | 400 | ____ | ____ | ✅/❌ |

---

### 场景3：测试空文件

#### 步骤1-2：同上（POST请求，URL相同）

#### 步骤3：配置Body
1. 点击 **"Body"** 标签
2. 选择 **"form-data"**
3. 在表格中：
   - **Key**：`file`
   - **Key右侧下拉框**：选择 **"File"**
   - **Value**：点击 **"Select Files"**，选择 `empty.txt`（空文件）

#### 步骤4：发送并记录
1. 点击 **"Send"**
2. 记录结果

---

### 场景4：测试正常文件上传（对比用）

#### 步骤1-2：同上

#### 步骤3：配置Body
- 选择正常的小图片文件（小于5MB，如 `test.jpg`）

#### 步骤4：发送
- 如果成功，应该返回200状态码和文件URL
- 如果失败，记录错误信息

---

## 🔽 第二部分：测试文件下载

### 场景1：测试文件不存在

#### 步骤1：创建新请求
1. 点击 **"+"** 创建新请求
2. 命名为：`文件下载测试-文件不存在`

#### 步骤2：配置请求
1. **HTTP方法**：选择 **"GET"**
2. **URL**：`{{base_url}}/api/files/leave-proofs/nonexistent.jpg`
   - 或直接输入：`http://localhost:8080/api/files/leave-proofs/nonexistent.jpg`
   - 注意：这个文件肯定不存在，用来测试404错误

#### 步骤3：发送请求
1. 点击 **"Send"**
2. 查看响应：
   - **状态码**：应该是 `404`
   - **响应内容**：查看错误信息

#### 步骤4：记录结果
| 测试场景 | 预期状态码 | 实际状态码 | 错误提示 | 是否友好 |
|---------|-----------|-----------|---------|---------|
| 文件不存在 | 404 | ____ | ____ | ✅/❌ |

---

### 场景2：测试路径遍历攻击

#### 步骤1：创建新请求
- 命名为：`文件下载测试-路径遍历`

#### 步骤2：配置请求
1. **HTTP方法**：`GET`
2. **URL**：`{{base_url}}/api/files/leave-proofs/../../../etc/passwd`
   - 这是尝试访问系统文件的路径

#### 步骤3：发送并记录
1. 点击 **"Send"**
2. 查看响应：
   - **状态码**：应该是 `403` 或 `404`（不应该返回真实的系统文件）
   - **响应内容**：不应该包含系统文件内容

#### 步骤4：记录结果
| 测试场景 | 预期状态码 | 实际状态码 | 错误提示 | 是否友好 |
|---------|-----------|-----------|---------|---------|
| 路径遍历 | 403/404 | ____ | ____ | ✅/❌ |

---

## 📝 完整测试结果记录表

复制下面的表格，填写所有测试结果：

| 测试场景 | 预期状态码 | 实际状态码 | 错误提示 | 是否友好 | 备注 |
|---------|-----------|-----------|---------|---------|------|
| 文件过大 | 400/413 | | | | |
| 文件类型不支持 | 400 | | | | |
| 空文件 | 400 | | | | |
| 目录不存在 | 500 | | | | |
| 文件不存在 | 404 | | | | |
| 路径遍历 | 403/404 | | | | |

---

## ⚠️ 常见问题解决

### 问题1：找不到"form-data"选项
- **解决**：确保点击的是 **"Body"** 标签，不是 "Params" 或其他标签

### 问题2：选择文件后显示"Text"而不是"File"
- **解决**：点击Key右侧的下拉框，手动选择 **"File"**

### 问题3：上传成功但想测试失败场景
- **解决**：确保文件真的超过5MB，或者使用不支持的文件类型

### 问题4：不知道文件大小
- **解决**：右键点击文件 → 属性 → 查看文件大小
- 1MB = 1024KB，5MB = 5120KB

### 问题5：无法创建空文件
- **解决**：
  1. 打开记事本
  2. **不要输入任何内容**
  3. 直接保存为 `empty.txt`

---

## ✅ 检查清单

测试完成后，确认以下内容：

- [ ] 所有6个场景都已测试
- [ ] 每个场景都记录了实际状态码
- [ ] 每个场景都记录了错误提示信息
- [ ] 判断了错误提示是否对用户友好
- [ ] 填写了完整的测试结果表格

---

## 🎯 测试要点总结

**文件上传测试关键点：**
1. ✅ 使用 **"form-data"**，不是JSON
2. ✅ Key必须是 `file`（根据接口定义）
3. ✅ Key类型必须选择 **"File"**
4. ✅ 准备不同大小和类型的测试文件

**文件下载测试关键点：**
1. ✅ 使用 **"GET"** 方法
2. ✅ URL路径要正确
3. ✅ 测试不存在的文件路径
4. ✅ 测试路径遍历攻击

---

**测试完成后，将结果填写到 `任务5_文件上传下载测试详细操作指南.md` 的表格中！**










