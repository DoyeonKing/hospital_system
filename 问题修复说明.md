# 问题修复说明

## 已修复的问题

### 1. ✅ 重复日志问题
**问题**：`isConfirmedStatus` 和 `canCancelAppointment` 方法在模板中被频繁调用，导致控制台输出大量重复日志。

**修复**：已注释掉 `detail.vue` 中这两个方法里的 `console.log` 语句，减少不必要的日志输出。

**文件**：`uni_app/pages/appointment/detail.vue`

---

### 2. ✅ IP地址配置问题
**问题**：配置文件中设置的 IP 地址（`172.20.10.3`）与当前电脑的实际 IP 地址（`10.61.104.207`）不匹配。

**修复**：已更新 `uni_app/config/index.js` 中的 `LOCAL_IP` 为当前检测到的 IP 地址。

**注意**：
- 如果是在**微信开发者工具**中运行，会自动使用 `localhost:8080`
- 如果是在**真机调试**，需要使用电脑的局域网 IP 地址
- 如果 IP 地址变化，需要重新更新 `LOCAL_IP` 的值

---

## 需要手动检查的问题

### 3. ⚠️ 后端服务问题

#### 3.1 后端服务是否启动
**检查方法**：
1. 确认 Spring Boot 后端服务正在运行
2. 在浏览器访问：`http://localhost:8080/api/health`（如果有健康检查接口）
3. 或者访问：`http://localhost:8080/api/departments/tree` 看是否能正常返回

#### 3.2 后端编译错误
**错误信息**：
```
NoClassDefFoundError: com/example/springboot/dto/patient/PatientProfileResponse
```

**可能原因**：
1. 类文件缺失或未编译
2. 依赖包问题
3. 类路径配置错误

**解决方法**：
1. **重新编译项目**：
   ```bash
   # 在 Spring Boot 项目目录下
   mvn clean compile
   # 或
   mvn clean package
   ```

2. **检查类文件是否存在**：
   - 确认 `PatientProfileResponse.java` 文件存在
   - 确认文件在正确的包路径下：`com/example/springboot/dto/patient/`

3. **检查依赖**：
   - 确认所有依赖都已正确下载
   - 运行 `mvn dependency:resolve`

4. **重启后端服务**：
   - 停止当前运行的服务
   - 重新启动 Spring Boot 应用

---

### 4. ⚠️ 网络连接问题

#### 4.1 请求失败：`{errMsg: "request:fail", errno: undefined}`

**可能原因**：
1. 后端服务未启动
2. IP 地址配置错误
3. 防火墙阻止连接
4. 网络不通

**检查步骤**：
1. **确认后端服务运行**：
   - 检查 Spring Boot 是否在 8080 端口运行
   - 查看后端控制台是否有错误

2. **检查 IP 配置**：
   - 开发者工具：应该使用 `localhost:8080`
   - 真机调试：应该使用电脑的局域网 IP（如 `10.61.104.207:8080`）

3. **检查防火墙**：
   - Windows：确保防火墙允许 8080 端口
   - 或者临时关闭防火墙测试

4. **测试网络连接**：
   - 在浏览器访问：`http://localhost:8080/api/departments/tree`
   - 如果浏览器能访问，说明后端正常，问题在前端配置

---

## 快速修复步骤

### 步骤 1：检查后端服务
```bash
# 1. 确认后端服务正在运行
# 2. 在浏览器测试：http://localhost:8080/api/departments/tree
```

### 步骤 2：更新 IP 配置（如需要）
如果 IP 地址变化，更新 `uni_app/config/index.js`：
```javascript
const LOCAL_IP = '你的实际IP地址'  // 运行 ipconfig 查看
```

### 步骤 3：重新编译前端
在 uni-app 项目目录下：
```bash
# 重新编译小程序
npm run dev:mp-weixin
```

### 步骤 4：重启后端服务
```bash
# 在 Spring Boot 项目目录下
mvn clean package
java -jar target/你的项目名.jar
```

---

## 配置说明

### 当前配置（`uni_app/config/index.js`）
- **自动检测模式**：`USE_AUTO_DETECT = true`
- **开发者工具**：自动使用 `localhost:8080`
- **真机调试**：自动使用 `10.61.104.207:8080`（已更新）

### 如果 IP 地址变化
1. 运行 `ipconfig`（Windows）或 `ifconfig`（Mac/Linux）
2. 找到 "IPv4 地址"
3. 更新 `LOCAL_IP` 的值

---

## 常见问题

### Q: 为什么有些请求成功，有些失败？
A: 可能是后端某些接口有问题，或者后端服务不稳定。检查后端日志。

### Q: 真机调试时连接不上？
A: 
1. 确保手机和电脑连接同一个 WiFi
2. 确保 IP 地址正确（不是 `localhost`）
3. 确保防火墙允许 8080 端口

### Q: 开发者工具中连接不上？
A: 
1. 确保后端服务正在运行
2. 确保使用 `localhost:8080`（不是 IP 地址）
3. 检查后端控制台是否有错误

---

## 下一步

1. ✅ 已修复重复日志问题
2. ✅ 已更新 IP 配置
3. ⚠️ **需要检查后端服务是否正常运行**
4. ⚠️ **需要修复后端 `NoClassDefFoundError` 错误**

如果后端服务正常，但仍有请求失败，请检查：
- 后端日志中的具体错误信息
- 网络连接是否稳定
- 防火墙设置

