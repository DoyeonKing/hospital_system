# 任务4：application.yml 配置检查结果

## 检查时间
- **检查日期**：____年____月____日
- **配置文件**：`springboot/src/main/resources/application.yml`
- **检查人员**：D号成员

---

## 配置检查表

| 配置项 | 当前值 | 是否规范 | 问题描述 | 建议值 | 优先级 |
|-------|-------|---------|---------|--------|--------|
| **数据库配置** | | | | | |
| 数据库URL | ____ | ____ | ____ | ____ | ____ |
| 数据库用户名 | `root` | ⚠️ | 使用root用户，生产环境建议使用专用账户 | 使用专用数据库用户 | 中 |
| 数据库密码 | `123456` | ❌ | 硬编码，不安全，密码过于简单 | 使用环境变量 `${DB_PASSWORD}` | 高 |
| 连接池最小空闲连接 | `5` | ✅ | 合理 | - | 低 |
| 连接池最大连接数 | `20` | ✅ | 合理 | - | 低 |
| 连接超时时间 | `30000ms` (30秒) | ✅ | 合理 | - | 低 |
| 连接最大生存时间 | `1800000ms` (30分钟) | ✅ | 合理 | - | 低 |
| **服务器配置** | | | | | |
| 服务端口 | `8080` | ✅ | 合理 | - | 低 |
| 服务地址 | `0.0.0.0` | ⚠️ | 允许所有IP访问，生产环境建议限制 | 生产环境限制为特定IP | 中 |
| 最大线程数 | `200` | ✅ | 合理 | - | 低 |
| 最小空闲线程 | `10` | ✅ | 合理 | - | 低 |
| 最大连接数 | `10000` | ✅ | 合理 | - | 低 |
| 等待队列长度 | `100` | ✅ | 合理 | - | 低 |
| **文件上传配置** | | | | | |
| 最大文件大小 | `5MB` | ✅ | 明确，合理 | - | 低 |
| 最大请求大小 | `10MB` | ✅ | 合理 | - | 低 |
| 文件上传目录 | `images/doctors/` | ✅ | 配置正确 | - | 低 |
| 自定义上传路径 | `uploads/` | ✅ | 配置正确 | - | 低 |
| **日志配置** | | | | | |
| Spring日志级别 | `INFO` | ✅ | 合理 | - | 低 |
| 应用日志级别 | `DEBUG` | ⚠️ | 开发环境可用，生产环境建议改为INFO | 生产环境改为INFO | 中 |
| 日志输出格式 | 未配置 | ⚠️ | 缺少日志格式配置，可能影响日志可读性 | 配置日志格式（pattern） | 中 |
| 日志文件输出 | 未配置 | ⚠️ | 只有控制台输出，缺少文件输出 | 配置日志文件路径和轮转 | 中 |
| **安全配置** | | | | | |
| Spring Security | 已注释 | ⚠️ | 安全配置被注释，可能缺少认证授权 | 根据需求启用并配置 | 高 |
| 跨域配置 | 未在配置文件中看到 | ⚠️ | 可能通过代码配置，需检查是否限制域名 | 生产环境应限制允许的域名 | 中 |
| **Redis配置** | | | | | |
| Redis主机 | `localhost` | ⚠️ | 硬编码，生产环境建议使用环境变量 | 使用环境变量 `${REDIS_HOST}` | 中 |
| Redis端口 | `6379` | ✅ | 默认端口，合理 | - | 低 |
| Redis连接池配置 | `max-active: 8, max-idle: 8, min-idle: 0` | ✅ | 合理 | - | 低 |
| **其他配置** | | | | | |
| JPA DDL自动更新 | `none` | ✅ | 禁用自动DDL，避免外键约束问题 | - | 低 |
| SQL显示 | `true` | ⚠️ | 开发环境可用，生产环境建议关闭 | 生产环境改为false | 中 |
| Swagger UI路径 | `/swagger-ui.html` | ⚠️ | 生产环境建议禁用或限制访问 | 生产环境禁用或添加访问控制 | 中 |

---

## 配置问题汇总

### 🔴 高优先级问题（必须修复）

#### 1. 数据库密码硬编码
- **问题**：密码 `123456` 直接写在配置文件中，存在严重安全风险
- **影响**：配置文件可能被泄露，导致数据库被非法访问
- **建议**：
  ```yaml
  # 修改为使用环境变量
  password: ${DB_PASSWORD:123456}  # 默认值仅用于开发环境
  ```
  - 生产环境：使用环境变量或配置中心（如Spring Cloud Config）
  - 开发环境：可以使用默认值，但建议也使用环境变量

#### 2. Spring Security未配置
- **问题**：安全配置被注释，系统可能缺少认证授权机制
- **影响**：API可能被未授权访问，存在安全风险
- **建议**：
  - 检查代码中是否有其他安全配置（如JWT、拦截器等）
  - 根据业务需求启用并配置Spring Security
  - 至少对敏感接口添加认证授权

---

### 🟡 中优先级问题（建议修复）

#### 1. 服务地址0.0.0.0
- **问题**：允许所有IP访问
- **建议**：生产环境限制为特定IP或使用反向代理

#### 2. 日志级别DEBUG
- **问题**：生产环境日志量过大
- **建议**：生产环境改为INFO
  ```yaml
  logging:
    level:
      com.example.springboot: INFO  # 生产环境改为INFO
  ```

#### 3. 缺少日志文件配置
- **问题**：只有控制台输出，不利于日志管理
- **建议**：添加日志文件配置
  ```yaml
  logging:
    file:
      name: logs/hospital-system.log
      max-size: 10MB
      max-history: 30
  ```

#### 4. Redis主机硬编码
- **问题**：生产环境可能需要不同的Redis地址
- **建议**：使用环境变量
  ```yaml
  spring:
    data:
      redis:
        host: ${REDIS_HOST:localhost}
  ```

#### 5. SQL显示开启
- **问题**：可能泄露敏感信息
- **建议**：生产环境关闭
  ```yaml
  spring:
    jpa:
      show-sql: false  # 生产环境改为false
  ```

#### 6. Swagger UI未限制
- **问题**：生产环境可能暴露API文档
- **建议**：
  - 生产环境禁用Swagger
  - 或添加访问控制（IP白名单、认证等）

#### 7. 数据库使用root用户
- **问题**：权限过大，存在安全风险
- **建议**：创建专用数据库用户，只授予必要权限

#### 8. 跨域配置未限制
- **问题**：可能允许所有域名访问
- **建议**：检查代码中的跨域配置，生产环境应限制允许的域名

---

### 🟢 低优先级问题（优化建议）

大部分配置项都合理，主要是以下优化建议：

1. **数据库连接池配置** - 当前配置合理，可根据实际负载调整
2. **服务器线程池配置** - 当前配置合理
3. **文件上传配置** - 当前配置合理

---

## 配置规范性评分

| 类别 | 评分 | 说明 |
|-----|------|------|
| 数据库配置 | 7/10 | 密码硬编码扣分 |
| 服务器配置 | 9/10 | 地址配置需优化 |
| 文件上传配置 | 10/10 | 配置完善 |
| 日志配置 | 6/10 | 缺少文件输出和格式配置 |
| 安全配置 | 4/10 | 安全配置不足 |
| Redis配置 | 7/10 | 主机硬编码 |
| **总体评分** | **7.2/10** | 基本规范，但存在安全隐患 |

---

## 改进建议总结

### 立即改进（高优先级）
1. ✅ 将数据库密码改为环境变量
2. ✅ 启用并配置Spring Security

### 近期改进（中优先级）
1. ✅ 配置日志文件输出和格式
2. ✅ 生产环境关闭SQL显示和DEBUG日志
3. ✅ 限制服务访问地址和跨域配置
4. ✅ 使用环境变量管理Redis配置

### 长期优化（低优先级）
1. ✅ 根据实际负载调整连接池和线程池配置
2. ✅ 创建专用数据库用户
3. ✅ 完善监控和告警配置

---

## 检查结论

**配置规范性评价**：基本规范，但存在安全隐患

**主要优点**：
- ✅ 数据库连接池配置合理
- ✅ 服务器线程池配置合理
- ✅ 文件上传配置完善
- ✅ 大部分配置都有注释说明

**主要问题**：
- ❌ 数据库密码硬编码（高优先级）
- ❌ Spring Security未配置（高优先级）
- ⚠️ 日志配置不完善（中优先级）
- ⚠️ 生产环境安全配置不足（中优先级）

**建议**：在部署到生产环境前，必须解决高优先级问题，并尽可能修复中优先级问题。

---

**检查完成日期**：____年____月____日  
**检查人员签名**：____

