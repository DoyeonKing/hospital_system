# 微信小程序体验版发布指南

## 📋 前置准备

### 1. 确认小程序账号状态
- ✅ 已注册微信小程序账号（AppID: `wx163a1fc0af4eee09`）
- ✅ 已完成小程序基本信息设置
- ✅ 已配置服务器域名（重要！）

### 2. 配置服务器域名（必须！）

**重要提示**：微信小程序要求所有网络请求必须使用已配置的服务器域名，不能使用IP地址。

#### 配置步骤：
1. 登录 [微信公众平台](https://mp.weixin.qq.com/)
2. 进入 **开发** → **开发管理** → **开发设置**
3. 找到 **服务器域名** 配置
4. 配置以下域名：

**request合法域名**（必须配置）：
```
https://your-api-domain.com
```

**uploadFile合法域名**（如果使用文件上传）：
```
https://your-api-domain.com
```

**downloadFile合法域名**（如果使用文件下载）：
```
https://your-api-domain.com
```

⚠️ **注意事项**：
- 域名必须使用 `https://` 协议
- 域名必须已备案（或使用云服务商提供的已备案域名）
- 不能使用 `localhost`、`127.0.0.1` 或IP地址
- 体验版也需要配置域名，否则无法访问后端API

---

## 🔧 配置生产环境API地址

### 步骤1：准备云服务器和域名

如果你已经连接了云数据库，通常需要：
1. **云服务器**：部署后端Spring Boot服务
2. **域名**：已备案的域名（或使用云服务商提供的域名）
3. **SSL证书**：配置HTTPS（微信小程序要求）

### 步骤2：修改API配置

编辑 `uni_app/config/index.js` 文件：

```javascript
// 生产环境配置
const production = {
	baseURL: 'https://your-api-domain.com',  // 👈 改为你的实际API域名
	aiBaseURL: 'https://your-ai-api-domain.com'  // 👈 AI服务域名（如果有）
}

// 根据环境切换配置
const isProduction = process.env.NODE_ENV === 'production'
const config = isProduction ? production : development
```

### 步骤3：配置环境变量（推荐方式）

创建不同环境的配置文件：

**方式一：使用环境变量**
```javascript
// uni_app/config/index.js
const isProduction = process.env.NODE_ENV === 'production' || process.env.UNI_PLATFORM === 'mp-weixin'

const production = {
	baseURL: 'https://api.yourdomain.com',
	aiBaseURL: 'https://ai-api.yourdomain.com'
}

const config = isProduction ? production : development
```

**方式二：手动切换（简单但需要记住切换）**
```javascript
// uni_app/config/index.js
// 发布体验版时，临时修改这里
const USE_PRODUCTION = true  // 👈 发布时改为 true

const config = USE_PRODUCTION ? production : development
```

---

## 🚀 编译和上传体验版

### 步骤1：使用HBuilderX编译

1. **打开项目**
   - 使用 HBuilderX 打开 `uni_app` 文件夹

2. **检查配置**
   - 确认 `manifest.json` 中的 `appid` 正确：`wx163a1fc0af4eee09`
   - 确认 `project.config.json` 中的 `appid` 正确

3. **编译为微信小程序**
   - 点击菜单：**发行** → **小程序-微信**
   - 或者使用快捷键：`Ctrl + Shift + P`，输入 "发行"
   - 选择 **小程序-微信（仅适用于uni-app）**

4. **等待编译完成**
   - 编译完成后，会自动打开微信开发者工具
   - 编译产物在 `uni_app/unpackage/dist/build/mp-weixin/` 目录

### 步骤2：使用微信开发者工具上传

1. **打开微信开发者工具**
   - 如果编译后自动打开，直接使用
   - 如果没有，手动打开微信开发者工具

2. **导入项目**
   - 项目目录：选择 `uni_app/unpackage/dist/build/mp-weixin/`
   - AppID：`wx163a1fc0af4eee09`
   - 项目名称：医院系统（或自定义）

3. **测试功能**
   - 在开发者工具中测试主要功能
   - 确认API请求正常（需要配置好服务器域名）

4. **上传代码**
   - 点击工具栏的 **上传** 按钮
   - 填写版本号（如：1.0.0）
   - 填写项目备注（如：体验版-医院挂号系统）
   - 点击 **上传**

---

## 👥 发布体验版并分享

### 步骤1：在微信公众平台设置体验版

1. **登录微信公众平台**
   - 访问：https://mp.weixin.qq.com/
   - 使用小程序管理员账号登录

2. **进入版本管理**
   - 点击左侧菜单：**版本管理**
   - 在 **开发版本** 中可以看到刚上传的版本

3. **设置为体验版**
   - 找到刚上传的版本
   - 点击 **选为体验版** 按钮
   - 确认后，该版本会出现在 **体验版** 列表中

### 步骤2：添加体验者

1. **添加体验者账号**
   - 在 **版本管理** → **体验版** 中
   - 点击 **体验成员** 或 **添加体验者**
   - 输入体验者的微信号（不是昵称！）
   - 点击 **添加**

2. **体验者扫码体验**
   - 体验者用微信扫描体验版二维码
   - 或在微信中搜索小程序名称进入

### 步骤3：分享体验版

**方式一：分享体验版二维码**
- 在版本管理页面，复制体验版二维码
- 发送给需要体验的用户

**方式二：分享体验版链接**
- 复制体验版链接
- 发送给体验者，他们点击链接即可打开

**方式三：直接搜索（如果已发布过正式版）**
- 体验者可以在微信中搜索小程序名称
- 如果小程序已发布过正式版，体验者需要：
  1. 删除已安装的正式版
  2. 通过体验版链接或二维码重新进入

---

## ⚠️ 常见问题解决

### 问题1：网络请求失败

**原因**：未配置服务器域名或域名配置错误

**解决**：
1. 检查微信公众平台 → 开发设置 → 服务器域名是否已配置
2. 确认域名使用 `https://` 协议
3. 确认域名已备案（或使用云服务商提供的已备案域名）
4. 检查 `config/index.js` 中的 `baseURL` 是否正确

### 问题2：体验者无法打开小程序

**原因**：未添加为体验者

**解决**：
1. 在版本管理 → 体验版 → 体验成员中添加该用户
2. 确认输入的微信号正确（不是昵称）

### 问题3：编译后功能异常

**原因**：可能是编译配置问题

**解决**：
1. 清理编译缓存：删除 `uni_app/unpackage` 目录
2. 重新编译
3. 检查 `manifest.json` 和 `project.config.json` 配置

### 问题4：API请求返回错误

**原因**：生产环境API地址配置错误或服务器未启动

**解决**：
1. 确认云服务器上的后端服务正在运行
2. 确认API域名可以正常访问
3. 检查服务器防火墙和云服务商安全组配置
4. 确认SSL证书配置正确（必须使用HTTPS）

---

## 📝 发布前检查清单

- [ ] 已配置服务器域名（微信公众平台）
- [ ] 已修改 `config/index.js` 为生产环境API地址
- [ ] 已测试所有主要功能
- [ ] 已编译并上传代码
- [ ] 已设置为体验版
- [ ] 已添加体验者
- [ ] 已测试体验版功能正常

---

## 🎯 下一步：正式版发布

体验版测试通过后，可以申请正式版发布：

1. **提交审核**
   - 在版本管理 → 审核版本中提交审核
   - 填写小程序信息、类目等

2. **等待审核**
   - 通常1-7个工作日

3. **发布上线**
   - 审核通过后，点击发布即可

**注意**：正式版发布需要：
- ✅ 小程序已备案（个人主体需要，企业主体部分类目需要）
- ✅ 完成所有必填信息
- ✅ 通过微信审核

---

## 💡 快速发布体验版（简化流程）

如果你只是想快速测试体验版功能，可以：

1. **临时使用测试域名**（仅用于体验版测试）
   - 使用内网穿透工具（如 ngrok、natapp）获取临时HTTPS域名
   - 在微信公众平台配置该临时域名
   - 注意：这种方式不稳定，仅用于临时测试

2. **使用云服务商提供的测试域名**
   - 很多云服务商提供临时测试域名
   - 配置到微信公众平台即可

3. **本地测试**
   - 如果只是自己测试，可以在微信开发者工具中直接测试
   - 不需要上传体验版

---

## 📞 需要帮助？

如果遇到问题，可以：
1. 查看微信小程序官方文档：https://developers.weixin.qq.com/miniprogram/dev/framework/
2. 查看uni-app官方文档：https://uniapp.dcloud.net.cn/
3. 检查项目中的其他文档和配置文件



