# 二维码数据初始化说明

## 📋 执行步骤

### 1. 执行数据库脚本

```bash
# 步骤1: 添加二维码字段（如果还没有执行）
mysql -u root -p123456 hospital_05 < sql语句/修改语句/add_qrcode_to_map_nodes.sql

# 步骤2: 初始化所有节点的二维码内容
mysql -u root -p123456 hospital_05 < sql语句/修改语句/init_qrcode_for_all_nodes.sql
```

### 2. 查看节点数据

执行以下SQL查看所有节点和二维码信息：

```sql
SELECT 
    node_id,
    node_name,
    coordinates_x,
    coordinates_y,
    floor_level,
    qrcode_content,
    qrcode_status
FROM map_nodes
ORDER BY node_id;
```

### 3. 生成二维码图片

#### 方法1：使用Python脚本（推荐）

```bash
cd tools
pip install qrcode[pil] mysql-connector-python
python generate_all_qrcodes.py
```

脚本会：
- 自动从数据库读取所有节点
- 为每个节点生成二维码图片
- 保存到 `qrcode/` 目录

#### 方法2：使用HTML工具

打开 `tools/qrcode_generator.html`，所有节点的二维码会自动显示。

#### 方法3：使用在线API

访问以下链接生成二维码（替换节点ID）：
```
https://api.qrserver.com/v1/create-qr-code/?size=500x500&data=HOSPITAL_NODE_1
```

### 4. 上传二维码到系统

生成二维码图片后，使用API上传：

```bash
# 上传节点1的二维码
curl -X POST http://localhost:8080/api/qrcode/upload/1 \
  -F "file=@qrcode_node_1_医院大门.png"
```

或者使用Postman等工具上传。

### 5. 验证二维码

上传成功后，查询节点状态应该变为 `ACTIVE`：

```sql
SELECT node_id, node_name, qrcode_status, qrcode_image_path
FROM map_nodes
WHERE qrcode_status = 'ACTIVE';
```

## 📊 当前数据库状态

根据查询，数据库中有：
- **14个地图节点** - 所有节点都已生成二维码内容
- **14个诊室** - 对应不同的节点

## 🎯 关键节点建议

建议优先为以下关键节点生成和上传二维码：
1. **医院大门** - 入口位置
2. **分诊台** - 重要服务点
3. **电梯口** - 交通枢纽
4. **各诊室** - 就诊地点

## 📝 二维码内容格式

所有二维码内容格式统一为：`HOSPITAL_NODE_{nodeId}`

例如：
- 节点1: `HOSPITAL_NODE_1`
- 节点2: `HOSPITAL_NODE_2`
- ...

## 🔍 查看诊室对应的二维码

执行以下SQL查看诊室和节点的对应关系：

```sql
SELECT 
    l.location_id,
    l.location_name,
    l.building,
    l.room_number,
    n.node_id,
    n.qrcode_content
FROM locations l
LEFT JOIN map_nodes n ON l.map_node_id = n.node_id
ORDER BY l.location_id;
```








