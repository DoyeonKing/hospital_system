# 科室管理模块更新说明

## 概述
基于新的数据库结构（parent_departments 和 departments 表），完成了科室管理模块的全面更新，使其完全兼容新的数据库表结构。

## 数据库结构变化
- **原结构**: 单一 `departments` 表，通过 `parent_id` 自引用实现层级关系
- **新结构**: 
  - `parent_departments` 表：存储父科室信息
  - `departments` 表：存储子科室信息，通过 `parent_id` 关联到父科室

## 后端修改

### 1. 实体类更新
- **新增**: `ParentDepartment.java` - 父科室实体类
- **更新**: `Department.java` - 子科室实体类，关联到 `ParentDepartment`

### 2. Repository层更新
- **新增**: `ParentDepartmentRepository.java` - 父科室数据访问层
- **更新**: `DepartmentRepository.java` - 添加父科室相关查询方法

### 3. Service层更新
- **新增**: `ParentDepartmentService.java` - 父科室业务逻辑
- **更新**: `DepartmentService.java` - 适配新的数据库结构，所有操作都需要指定父科室

### 4. Controller层更新
- **新增**: `ParentDepartmentController.java` - 父科室管理API
- **更新**: `DepartmentController.java` - 子科室管理API，添加父科室相关接口

### 5. DTO更新
- **更新**: `DepartmentQueryDTO.java` - 添加 `parentDepartmentId` 字段
- **更新**: `DepartmentSpecification.java` - 添加父科室ID查询条件

## 前端修改

### 1. API服务更新
- **更新**: `department.js` - 添加父科室相关API方法
  - `getAllParentDepartments()` - 获取所有父科室
  - `getDepartmentsByParentId()` - 根据父科室ID获取子科室

### 2. 页面组件更新
- **更新**: `Index.vue` - 科室列表页面
  - 添加父科室筛选功能
  - 显示所属父科室信息
  - 移除树形结构，改为平铺显示
  
- **更新**: `CreateDepartment.vue` - 创建科室页面
  - 必须选择父科室
  - 更新表单验证规则
  
- **更新**: `Members.vue` - 科室成员管理页面
  - 适配新的API接口

## 主要功能变化

### 1. 科室创建
- **之前**: 可以选择上级科室（可选）
- **现在**: 必须选择父科室（必选）

### 2. 科室显示
- **之前**: 树形结构显示
- **现在**: 平铺列表显示，包含父科室信息

### 3. 科室搜索
- **新增**: 可以按父科室筛选子科室

## API接口变化

### 新增接口
- `GET /api/departments/parents` - 获取所有父科室
- `GET /api/departments/parent/{parentId}` - 根据父科室ID获取子科室
- `GET /api/parent-departments` - 父科室管理接口

### 修改接口
- `POST /api/departments` - 创建子科室，必须提供 `parentDepartmentName`
- `GET /api/departments` - 查询子科室，支持按父科室筛选

## 注意事项

1. **数据迁移**: 需要将现有的科室数据迁移到新的表结构中
2. **父科室管理**: 新增了父科室管理功能，需要先创建父科室才能创建子科室
3. **API兼容性**: 部分API接口的参数和返回值发生了变化
4. **前端路由**: 确保前端路由配置正确，特别是成员管理页面的路由

## 测试建议

1. 测试父科室的增删改查功能
2. 测试子科室的创建（必须指定父科室）
3. 测试按父科室筛选子科室功能
4. 测试科室成员管理功能
5. 测试分页和搜索功能

## 部署说明

1. 先执行数据库迁移脚本
2. 部署后端代码
3. 部署前端代码
4. 验证所有功能正常工作
