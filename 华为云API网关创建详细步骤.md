# 华为云API网关创建详细步骤

## 📍 当前状态

你现在在 **API网关（APIG）** 的总览页面。左侧显示"请选择实例"和"暂未匹配到数据"，说明还没有创建API网关实例。

---

## 🚀 创建API网关完整步骤

### 第一步：创建API网关实例

1. **在左侧菜单找到"实例管理"**
   - 如果左侧菜单没有展开，点击左侧的"APIG"展开菜单
   - 找到 **"实例管理"** 或 **"专享版实例"** 或 **"共享版"**

2. **选择版本类型**
   - **共享版**：免费，适合测试（推荐）
   - **专享版**：付费，性能更好，适合生产环境
   
   **建议**：先选择 **共享版**（免费）进行测试

3. **创建实例**
   - 点击 **"创建实例"** 或 **"购买实例"** 按钮
   - 如果选择共享版，通常可以直接使用，无需创建
   - 如果选择专享版，需要填写配置并付费

### 第二步：创建API分组（重要！这里会分配测试域名）

1. **进入API分组页面**
   - 在左侧菜单找到 **"API分组"** 或 **"API管理"** → **"API分组"**
   - 点击进入

2. **创建分组**
   - 点击 **"创建分组"** 或 **"新建分组"** 按钮
   - 填写分组信息：
     ```
     分组名称：hospital-api（自定义）
     描述：医院系统API（可选）
     实例：选择你创建的实例（如果是共享版，可能自动选择）
     ```

3. **获取测试域名**
   - 创建分组后，系统会自动分配一个测试域名
   - 格式：`xxxxx.apigw.huaweicloud.com`
   - **这个就是你要用的免费域名！**
   - 复制保存这个域名

### 第三步：创建API

1. **进入API管理**
   - 在左侧菜单找到 **"API管理"** → **"APIs"**
   - 或直接在API分组页面点击 **"创建API"**

2. **配置API基本信息**
   ```
   API名称：医院系统API（自定义）
   所属分组：选择刚才创建的分组
   安全认证：APP认证（或选择"无认证"用于测试）
   请求协议：HTTPS
   请求方法：GET、POST、PUT、DELETE（根据需要选择）
   请求路径：/{path}（或具体路径如 /api/patients）
   ```

3. **配置后端服务**
   ```
   后端服务类型：HTTP
   后端服务地址：http://你的EIP:8080
   后端请求路径：/{path}（与请求路径对应）
   后端超时时间：5000ms
   ```

4. **配置请求参数（可选）**
   - 如果需要，可以配置请求参数、请求头等

5. **发布API**
   - 配置完成后，点击 **"发布"** 或 **"确定"**
   - API创建成功

### 第四步：测试API

1. **获取调用地址**
   - 在API详情页面，可以看到完整的调用地址
   - 格式：`https://xxxxx.apigw.huaweicloud.com/api/patients`

2. **测试访问**
   - 在浏览器或Postman中测试
   - 确认可以正常访问你的后端服务

---

## 🎯 快速操作路径

### 方式一：从左侧菜单导航

```
APIG（API网关）
  ↓
实例管理（如果需要创建实例）
  ↓
API分组 → 创建分组（获取测试域名）
  ↓
API管理 → APIs → 创建API
```

### 方式二：使用顶部搜索

1. 在顶部搜索栏输入：**API分组**
2. 点击进入API分组页面
3. 创建分组

---

## 📝 详细配置示例

### 示例1：创建简单的API（转发所有请求）

**API配置**：
```
API名称：医院系统-全部转发
请求路径：/{path}
请求方法：GET、POST、PUT、DELETE
后端服务：HTTP
后端地址：http://你的EIP:8080
后端路径：/{path}
```

这样配置后，所有请求都会转发到你的Spring Boot服务器。

### 示例2：创建具体的API（推荐）

**API配置**：
```
API名称：获取患者列表
请求路径：/api/patients
请求方法：GET
后端服务：HTTP
后端地址：http://你的EIP:8080
后端路径：/api/patients
```

---

## ⚙️ 重要配置说明

### 1. 安全认证

**选项**：
- **无认证**：适合测试，可以直接访问
- **APP认证**：需要配置AppKey和AppSecret（更安全）
- **IAM认证**：使用华为云IAM认证

**建议**：
- 测试阶段：选择"无认证"
- 正式使用：选择"APP认证"

### 2. 跨域配置（CORS）

如果小程序需要跨域访问：
- 在API分组设置中启用CORS
- 配置允许的源：`*`（测试）或具体域名（生产）

### 3. 流量控制

- 可以设置QPS限制
- 防止API被滥用

---

## 🔍 如果找不到创建按钮

### 可能的原因和解决方法：

1. **没有选择实例**
   - 在左侧"请选择实例"下拉框中选择实例
   - 如果没有实例，先创建实例

2. **权限不足**
   - 确认账号有API网关的创建权限
   - 联系管理员授权

3. **区域选择**
   - 确认在正确的区域（如：华北-北京四）
   - 不同区域的资源不互通

4. **版本问题**
   - 共享版可能不需要创建实例，直接创建分组即可
   - 专享版需要先创建实例

---

## ✅ 创建完成后

### 1. 获取测试域名

创建API分组后，你会得到一个测试域名：
```
https://xxxxx.apigw.huaweicloud.com
```

### 2. 配置到小程序

编辑 `uni_app/config/index.js`：

```javascript
const production = {
	baseURL: 'https://xxxxx.apigw.huaweicloud.com',  // 👈 你的API网关域名
	aiBaseURL: 'https://xxxxx.apigw.huaweicloud.com'
}

const USE_PRODUCTION = true
```

### 3. 在微信公众平台配置域名

1. 登录：https://mp.weixin.qq.com/
2. 进入：**开发** → **开发管理** → **开发设置**
3. 找到 **服务器域名**，点击 **修改**
4. 添加：`https://xxxxx.apigw.huaweicloud.com`
5. 保存

---

## 🚨 常见问题

### Q: 左侧菜单看不到"API分组"？

**A**: 
- 尝试刷新页面
- 确认在正确的区域
- 确认账号有权限

### Q: 创建分组后没有看到测试域名？

**A**: 
- 测试域名通常在分组详情页面
- 点击分组名称进入详情
- 在"域名"或"访问地址"部分查看

### Q: API创建后无法访问？

**A**: 
- 检查API是否已发布
- 检查后端服务地址是否正确
- 检查后端服务是否运行
- 检查安全组是否开放8080端口

### Q: 如何修改API配置？

**A**: 
- 在API列表中找到API
- 点击"编辑"或"修改"
- 修改后重新发布

---

## 📋 完整操作检查清单

- [ ] 已创建API网关实例（或使用共享版）
- [ ] 已创建API分组
- [ ] 已获取测试域名
- [ ] 已创建API并配置后端服务
- [ ] 已发布API
- [ ] 已测试API可以访问
- [ ] 已配置小程序使用该域名
- [ ] 已在微信公众平台配置域名

---

## 💡 提示

1. **共享版是免费的**，适合测试使用
2. **测试域名自带HTTPS**，无需额外配置SSL证书
3. **API网关可以统一管理**多个API
4. **可以设置不同的环境**（测试、生产）

---

## 📞 需要帮助？

如果还是找不到创建按钮：
1. 尝试刷新页面
2. 检查浏览器控制台是否有错误
3. 查看华为云API网关文档：https://support.huaweicloud.com/apig/
4. 联系华为云技术支持



